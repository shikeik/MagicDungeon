---
alwaysApply: true
---
# AI 自动开发流程

> **核心原则**: 严格遵循"环节推进"机制，完成一个环节后，**必须**重新回到此文件查看下一环节的行动指导。

## 核心循环流程图

```mermaid
flowchart TD
    Start([开始]) --> Pick[1. 智能拾取 & 启动]
    
    subgraph Execution [执行循环]
        Pick --> CheckComplex{任务过大?}
        CheckComplex -- 是 --> Decompose[1.5 任务拆解]
        Decompose --> Pick
        CheckComplex -- 否 --> Analyze[2. 需求分析 & 计划]
        Analyze --> Implement[3. 代码实现]
        Implement --> Verify[4. 验证测试]
        Verify --> Release[5. 版本 & 提交]
        Release --> Cleanup[6. 清理 & 交付]
    end
    
    Cleanup --> LoopCheck{任务达标 或 无任务?}
    LoopCheck -- 未结束 --> Pick
    LoopCheck -- 已结束 --> Summary[收尾统计]
    Summary --> End([结束])
```

## 1. 详细执行环节

### 第一阶段：任务启动 (Pick)
1.  **前置检查**: 确保工作区干净。若有未提交更改，**先提交**。
2.  **智能拾取**:
    - 从 `Tasks.md` 读取目标数。
    - 按优先级筛选: `Bug` > `Core` > `Opt` > `Misc`。
3.  **启动记录** (必须): 在 `Tasks.md` 顶部记录**开始时间** (精确到分钟)。

### 阶段 1.5：任务拆解 (Decompose - 可选)
> **触发条件**: 当拾取的任务过于复杂、模糊或预计耗时过长时。
1.  **拆解任务**: 将大任务分解为多个独立、可验证的小任务 (Todo)。
2.  **重组列表**: 更新 `Tasks.md` 将任务下罗列出拆解子任务。
3.  **重新拾取**: 返回 **第一阶段**，拾取拆解后的第一个子任务。

### 第二阶段：分析与计划 (Plan)
1.  **明确需求**: 深入分析任务影响范围。
2.  **制定计划**: 列出Trae `TODO` 清单，明确每一步的修改点。

### 第三阶段：实现与验证 (Do & Check)
1.  **实现变更**:
    - **小步修改**: 避免一次性修改过多文件。
    - **复用逻辑**: 优先使用现有工具类和模式。
    - **保持风格**: 代码风格需与现有代码库一致。
2.  **验证测试**:
    - **运行检查**: 执行 `./gradlew lwjgl3:run` 确保程序运行无崩溃。
    - **构建检查**: 执行 `./gradlew assemble` 确保编译完全通过。

### 第四阶段：交付与版本 (Deliver)
1.  **版本决策** (必须):
    - **内容性更新**: 必须执行发版。
        - **常规修复/优化**: 执行 `gradle bumpPatch`。
        - **次版本特性**: 执行 `gradle bumpMinor` (需遵循次版本流程: 确定主题 -> 开发 -> 提版 -> 下个主题 -> 提交)。
    - **纯杂项/文档**: 可跳过发版。
2.  **规范提交** (必须):
    - 使用中文编写 `commit_msg.txt`。
    - 执行 `git commit -F commit_msg.txt`。
    - **禁止 Push**: 仅本地提交。

### 第五阶段：清理与循环 (Loop)
1.  **清理交付**:
    - 移除临时 Log 和调试代码。
    - 更新相关文档。
    - **记录踩坑**: 若有价值，记录到 `.trae/documents/pitfalls`。
2.  **状态更新**:
    - 在 `Tasks.md` 中标记当前任务为 `[x] (待检查)` 并统一移动到下方待检查区
    - 更新 `[当前已完成]` 计数 (+1)。
3.  **循环决策**:
    - **未达标/有任务**: -> **回到第一阶段 (智能拾取)**。
    - **已达标/无任务**: -> **执行收尾**:
        1. 在 `Tasks.md` 顶部记录**完成时间**、**总耗时**、**实际完成数**, 精确到分钟。
        2. 重置 `[当前已完成]` 为 0。
        3. **结束流程**。

## 2. 常用命令速查
| 动作 | 命令 | 说明 |
| :--- | :--- | :--- |
| **运行** | `./gradlew lwjgl3:run` | 启动桌面端游戏 |
| **构建** | `./gradlew assemble` | 编译所有模块 |
| **清理** | `./gradlew clean` | 清理构建产物 |
| **发版** | `./gradlew bumpPatch` | 补丁版本升级 (0.0.x) |
| **发版** | `./gradlew bumpMinor` | 次版本升级 (0.x.0) |
