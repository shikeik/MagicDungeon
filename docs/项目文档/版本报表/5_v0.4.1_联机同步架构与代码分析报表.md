# v0.4.1 è”æœºåŒæ­¥æ¶æ„ä¸ä»£ç åˆ†ææŠ¥è¡¨

**æ—¥æœŸ**: 2026-03-01  
**ç‰ˆæœ¬**: 0.4.1  
**ä¸»é¢˜**: å•æœº/è”æœºä»£ç æ¶æ„åˆ†æ + åŒæ­¥é“¾è·¯å®Œæ•´ä»£ç èµ°è¯» + åŒæ­¥è´¨é‡è¯„ä¼°

---

## ä¸€ã€æ ¸å¿ƒç»“è®ºï¼šä¸€å¥—ä»£ç ï¼Œè”æœºä¸ºå¯é€‰æ‰©å±•å±‚

é¡¹ç›®**ä¸æ˜¯ä¸¤å¥—ç‹¬ç«‹ä»£ç **ã€‚`SimpleGameScreen` æ˜¯å”¯ä¸€çš„æ¸¸æˆåœºæ™¯ç±»ï¼ŒåŒæ—¶æ‰¿è½½å•æœºå’Œè”æœºä¸¤ç§æ¨¡å¼ã€‚  
é€šè¿‡æ„é€ å‚æ•° `lanService == null` åˆ¤æ–­å½“å‰æ¨¡å¼ï¼Œè”æœºé€»è¾‘ä½œä¸º**å¯é€‰æ—è·¯**åµŒå…¥ä¸»å¾ªç¯ã€‚

---

## äºŒã€æ€»ä½“æ¶æ„å›¾

### ç½‘ç»œæ‹“æ‰‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æˆ¿ä¸»ç©å®¶çš„è¿›ç¨‹                    â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Server  â”‚â—„â”€UDPâ”€â”€â–ºâ”‚ Client  â”‚ (è‡ªè¿æ¥)     â”‚
â”‚  â”‚ (çº¯ä¸­è½¬) â”‚       â”‚ guid=0  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚       â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ UDP
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client      â”‚    â”‚  Client      â”‚
â”‚  guid=1      â”‚    â”‚  guid=2      â”‚
â”‚  (æ™®é€šæˆå‘˜)   â”‚    â”‚  (æ™®é€šæˆå‘˜)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®åŒæ­¥æµ

```
å®¢æˆ·ç«¯A render0()
    â”‚
    â”œâ”€ updatePlayer(delta)     â† æœ¬åœ°è®¡ç®—ç§»åŠ¨/æ”»å‡»
    â”œâ”€ enemyAI.update(delta)   â† æœ¬åœ°è®¡ç®—æ•ŒäººAI
    â”‚
    â””â”€ updateLan(delta)
       â”œâ”€ sendLocalState(x, y, vx, vy, "idle")
       â”‚     â”‚
       â”‚     â–¼ UDP
       â”‚  LanPlayerSyncRequestPacket (cmd=41)
       â”‚     â”‚
       â”‚     â–¼ Server.onPlayerSyncRequest()
       â”‚  æ„å»º LanPlayerStateSnapshot
       â”‚  éå†æ‰€æœ‰å®¢æˆ·ç«¯ â†’
       â”‚     â”‚
       â”‚     â–¼ UDP (å¹¿æ’­)
       â”‚  LanPlayerSyncBroadcastPacket (cmd=42)
       â”‚     â”‚
       â”‚     â–¼ å®¢æˆ·ç«¯B.registerPacketSubscribers()
       â”‚  players.put(guid, toLanRoomPlayer(state))
       â”‚
       â”œâ”€ drainEvents() â†’ å¤„ç† CHAT/INFO äº‹ä»¶
       â”‚
       â””â”€ getRemotePlayers() â†’ æ›´æ–°è¿œç¨‹ç©å®¶å®ä½“
          â†’ Lerp æ’å€¼ visualX/visualY
          â†’ å†™å…¥ remotePlayers æ•°ç»„
             â”‚
             â–¼ GameRenderer.drawEntities()
          è¿œç¨‹ç©å®¶ä»¥æ©™è‰²æ–¹å—æ¸²æŸ“ (Color.ORANGE)
```

---

## ä¸‰ã€SimpleGameScreen â€” å•æœº/è”æœºä¸€ä½“åŒ–

### 3.1 æ„é€ æ–¹æ³•ï¼šæ¨¡å¼ç”±å‚æ•°å†³å®š

```java
// æ–‡ä»¶: examples/.../screens/main/SimpleGameScreen.java

public class SimpleGameScreen extends GScreen implements GameRenderer.GameState {

    /**
     * æ„é€ æ–¹æ³•
     * @param lanService è”æœºæœåŠ¡ï¼ˆå¯ä¸º null è¡¨ç¤ºå•äººæ¨¡å¼ï¼‰
     */
    public SimpleGameScreen(LanMultiplayerService lanService) {
        this.lanService = lanService;
    }

    // è”æœºå­ç³»ç»Ÿï¼ˆå¯ä¸º null è¡¨ç¤ºå•äººæ¨¡å¼ï¼‰
    private LanMultiplayerService lanService;
    private Array<GameEntity> remotePlayers = new Array<>();
    private ConcurrentHashMap<Integer, GameEntity> remotePlayerMap = new ConcurrentHashMap<>();
```

### 3.2 render0() ä¸»å¾ªç¯ï¼šè”æœºä»£ç å¦‚ä½•åµŒå…¥

```java
    @Override
    public void render0(float delta) {
        ScreenUtils.clear(0.05f, 0.05f, 0.08f, 1);

        // â”€â”€â”€â”€ é€šç”¨è¾“å…¥ â”€â”€â”€â”€
        if (virtualControls != null) virtualControls.update(delta);

        // â”€â”€â”€â”€ å•æœºæ ¸å¿ƒé€»è¾‘ï¼ˆè”æœºæ¨¡å¼ä¸‹ä¹Ÿç…§å¸¸è¿è¡Œï¼‰ â”€â”€â”€â”€
        if (player.alive) {
            gameTime += delta;
            updatePlayer(delta);          // ğŸ® ç§»åŠ¨/æ”»å‡»/å†·å´
            enemyAI.update(delta);        // ğŸ® æ•ŒäººAI
            player.mp = Math.min(player.getMaxMp(),
                player.mp + player.getMaxMp() * MP_REGEN_RATE * delta);  // ğŸ® MPå›å¤
        } else {
            InputManager input = InputManager.getInstance();
            if (input.isJustPressed(InputAction.RESET_MAP)) {
                respawnAfterDeath();
            }
        }

        // â”€â”€â”€â”€ é€šç”¨è§†è§‰æ’å€¼ â”€â”€â”€â”€
        player.updateVisuals(delta);
        for (int i = 0; i < enemies.size; i++) {
            enemies.get(i).updateVisuals(delta);
        }

        // â”€â”€â”€â”€ ğŸŒ è”æœºæ‰©å±•å±‚ï¼ˆå”¯ä¸€å…¥å£ï¼‰ â”€â”€â”€â”€
        updateLan(delta);  // å†…éƒ¨é¦–è¡Œ: if (lanService == null) return;

        renderer.updatePopups(delta);

        // â”€â”€â”€â”€ ä»¥ä¸‹å…¨æ˜¯æ¸²æŸ“ï¼ˆé€šç”¨ï¼‰ â”€â”€â”€â”€
        // ... ä¸–ç•Œæ¸²æŸ“ã€HUDã€æ­»äº¡è¦†ç›–å±‚ã€è™šæ‹Ÿè§¦æ§ ...

        // â”€â”€â”€â”€ è”æœº HUDï¼ˆä»…è”æœºæ—¶æ˜¾ç¤ºï¼‰ â”€â”€â”€â”€
        if (lanService != null && lanService.isConnected()) {
            batch.setProjectionMatrix(getUICamera().combined);
            batch.begin();
            hudFont.setColor(com.badlogic.gdx.graphics.Color.CYAN);
            hudFont.draw(batch, "è”æœºä¸­: " + lanService.getMode()
                + " | ç©å®¶: " + (lanService.getRemotePlayerCount() + 1),
                10, getUIViewport().getWorldHeight() - 90);
            hudFont.setColor(com.badlogic.gdx.graphics.Color.WHITE);
            batch.end();
        }
    }
```

### 3.3 è”æœºé€»è¾‘å…¥å£ï¼šupdateLan()

```java
    // ============ è”æœºé€»è¾‘ ============
    private void updateLan(float delta) {
        if (lanService == null || !lanService.isConnected()) return;  // å•æœºç›´æ¥è·³è¿‡

        // â‘  æ¶ˆè´¹ç½‘ç»œäº‹ä»¶ï¼ˆèŠå¤©/ç³»ç»Ÿæ¶ˆæ¯ï¼‰
        List<LanNetworkEvent> events = lanService.drainEvents();
        for (LanNetworkEvent e : events) {
            if (e.getType() == LanNetworkEvent.Type.CHAT) {
                logText = "[è”æœº] " + e.getMessage();
            } else if (e.getType() == LanNetworkEvent.Type.INFO) {
                logText = "[ç³»ç»Ÿ] " + e.getMessage();
            }
        }

        // â‘¡ å‘é€æœ¬åœ°çŠ¶æ€ï¼ˆå—é¢‘ç‡é™åˆ¶ï¼Œé»˜è®¤ 20Hzï¼‰
        if (player.alive) {
            lanService.sendLocalState(player.x, player.y, player.visualX, player.visualY, "idle");
        }

        // â‘¢ æ›´æ–°è¿œç¨‹ç©å®¶å®ä½“
        List<LanRoomPlayer> lanPlayers = lanService.getRemotePlayers();
        remotePlayers.clear();
        for (LanRoomPlayer lp : lanPlayers) {
            // è·³è¿‡å°šæœªå‘é€è¿‡ä½ç½®çš„ç©å®¶
            if (lp.getX() == 0 && lp.getY() == 0 && lp.getVx() == 0 && lp.getVy() == 0) continue;

            GameEntity re = remotePlayerMap.get(lp.getGuid());
            if (re == null) {
                int spawnX = Math.max(1, (int)lp.getX());
                int spawnY = Math.max(1, (int)lp.getY());
                re = new GameEntity(spawnX, spawnY, "player", 100, 10, 5, 0.2f, 0,
                    com.goldsprite.magicdungeon2.core.combat.WeaponRange.MELEE);
                re.visualX = lp.getVx();
                re.visualY = lp.getVy();
                remotePlayerMap.put(lp.getGuid(), re);
            }
            // æ›´æ–°é€»è¾‘åæ ‡
            re.x = (int)lp.getX();
            re.y = (int)lp.getY();
            // å¹³æ»‘æ’å€¼åˆ°ç›®æ ‡åƒç´ åæ ‡
            re.visualX += (lp.getVx() - re.visualX) * 10f * delta;
            re.visualY += (lp.getVy() - re.visualY) * 10f * delta;
            remotePlayers.add(re);
        }
    }
```

### 3.4 å•æœº vs è”æœºæ‰§è¡Œè·¯å¾„å¯¹æ¯”

```
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€ å•æœºæ¨¡å¼ â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€ è”æœºæ¨¡å¼ â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                          â”‚   â”‚                          â”‚
 æ„é€ å‚æ•°     â”‚ lanService = null         â”‚   â”‚ lanService = å®ä¾‹         â”‚
              â”‚                          â”‚   â”‚                          â”‚
 updatePlayer â”‚ âœ… æ­£å¸¸æ‰§è¡Œ              â”‚   â”‚ âœ… æ­£å¸¸æ‰§è¡Œï¼ˆä¸€æ ·çš„ä»£ç ï¼‰  â”‚
 enemyAI      â”‚ âœ… æ­£å¸¸æ‰§è¡Œ              â”‚   â”‚ âœ… æ­£å¸¸æ‰§è¡Œï¼ˆå„è‡ªç‹¬ç«‹AIï¼‰  â”‚
 MPå›å¤       â”‚ âœ… æ­£å¸¸æ‰§è¡Œ              â”‚   â”‚ âœ… æ­£å¸¸æ‰§è¡Œ               â”‚
              â”‚                          â”‚   â”‚                          â”‚
 updateLan    â”‚ âŒ ç¬¬ä¸€è¡Œ return (è·³è¿‡)   â”‚   â”‚ âœ… å‘é€çŠ¶æ€+æ¥æ”¶è¿œç¨‹ç©å®¶  â”‚
              â”‚                          â”‚   â”‚                          â”‚
 remotePlayersâ”‚ [] ç©ºæ•°ç»„                â”‚   â”‚ [è¿œç¨‹ç©å®¶å®ä½“...]          â”‚
 è”æœº HUD     â”‚ âŒ ä¸æ¸²æŸ“               â”‚   â”‚ âœ… æ˜¾ç¤º"è”æœºä¸­: HOST |..."â”‚
              â”‚                          â”‚   â”‚                          â”‚
 åœ°å›¾/æ•Œäºº    â”‚ æœ¬åœ°ç‹¬ç«‹                  â”‚   â”‚ æœ¬åœ°ç‹¬ç«‹ï¼ˆä¸åŒæ­¥ï¼‰         â”‚
 æˆ˜æ–—/æˆé•¿    â”‚ æœ¬åœ°ç‹¬ç«‹                  â”‚   â”‚ æœ¬åœ°ç‹¬ç«‹ï¼ˆä¸åŒæ­¥ï¼‰         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€è”æœºç½‘ç»œå±‚å®Œæ•´ä»£ç 

### 4.1 åè®®å®šä¹‰ â€” LanCommands

```java
// æ–‡ä»¶: core/.../network/lan/packet/LanCommands.java

public interface LanCommands {
    byte PLAYER_SYNC_REQUEST    = 41;  // å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨ï¼šä¸ŠæŠ¥è‡ªå·±çš„ä½ç½®
    byte PLAYER_SYNC_BROADCAST  = 42;  // æœåŠ¡å™¨ â†’ æ‰€æœ‰å®¢æˆ·ç«¯ï¼šå¹¿æ’­æŸç©å®¶ä½ç½®
    byte ROOM_PLAYERS_REQUEST   = 43;  // å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨ï¼šè¯·æ±‚æˆ¿é—´æˆå‘˜åˆ—è¡¨
    byte ROOM_PLAYERS_RESPONSE  = 44;  // æœåŠ¡å™¨ â†’ è¯·æ±‚è€…ï¼šè¿”å›æˆå‘˜åˆ—è¡¨
    byte GAME_START_REQUEST     = 45;  // æˆ¿ä¸»å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨ï¼šè¯·æ±‚å¼€å§‹æ¸¸æˆ
    byte GAME_START_BROADCAST   = 46;  // æœåŠ¡å™¨ â†’ æ‰€æœ‰å®¢æˆ·ç«¯ï¼šé€šçŸ¥å¼€å§‹æ¸¸æˆ
}
```

### 4.2 çŠ¶æ€å¿«ç…§ â€” LanPlayerStateSnapshot

```java
// æ–‡ä»¶: core/.../network/lan/packet/LanPlayerStateSnapshot.java
// åŒæ­¥çš„å®Œæ•´å­—æ®µç»“æ„

public class LanPlayerStateSnapshot {
    private int playerGuid;       // ç©å®¶å”¯ä¸€æ ‡è¯†
    private String playerName;    // ç©å®¶åç§°
    private float x;              // é€»è¾‘æ ¼å­åæ ‡ X
    private float y;              // é€»è¾‘æ ¼å­åæ ‡ Y
    private float vx;             // è§†è§‰åƒç´ åæ ‡ Xï¼ˆç”¨äºæ¸²æŸ“æ’å€¼ï¼‰
    private float vy;             // è§†è§‰åƒç´ åæ ‡ Yï¼ˆç”¨äºæ¸²æŸ“æ’å€¼ï¼‰
    private String action;        // åŠ¨ä½œæ ‡è¯†ï¼ˆå½“å‰å›ºå®šä¸º "idle"ï¼‰
    private long timestamp;       // æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
}
```

### 4.3 ä¸Šè¡ŒåŒ… â€” LanPlayerSyncRequestPacket (cmd=41)

```java
// æ–‡ä»¶: core/.../network/lan/packet/LanPlayerSyncRequestPacket.java
// å®¢æˆ·ç«¯æ¯å¸§ä¸ŠæŠ¥è‡ªèº«ä½ç½®ï¼ˆå—é¢‘ç‡é™åˆ¶ï¼‰

public class LanPlayerSyncRequestPacket extends Packet {
    private float x;
    private float y;
    private float vx;
    private float vy;
    private String action;
    private long timestamp;

    public LanPlayerSyncRequestPacket(int ownerGuid, float x, float y,
            float vx, float vy, String action, long timestamp) {
        super(ownerGuid);
        this.x = x; this.y = y; this.vx = vx; this.vy = vy;
        this.action = action; this.timestamp = timestamp;
    }

    @Override
    public byte getCommand() { return LanCommands.PLAYER_SYNC_REQUEST; }
}
```

### 4.4 ä¸‹è¡ŒåŒ… â€” LanPlayerSyncBroadcastPacket (cmd=42)

```java
// æ–‡ä»¶: core/.../network/lan/packet/LanPlayerSyncBroadcastPacket.java
// æœåŠ¡å™¨å°†æŸç©å®¶çš„æœ€æ–°ä½ç½®å¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯

public class LanPlayerSyncBroadcastPacket extends ResponsePacket {
    private LanPlayerStateSnapshot state;

    public LanPlayerSyncBroadcastPacket(int ownerGuid, int repCode,
            LanPlayerStateSnapshot state) {
        super(ownerGuid, repCode);
        this.state = state;
    }

    @Override
    public byte getCommand() { return LanCommands.PLAYER_SYNC_BROADCAST; }
}
```

### 4.5 æˆ¿é—´æˆå‘˜æŸ¥è¯¢

```java
// æ–‡ä»¶: core/.../network/lan/packet/LanRoomPlayersRequestPacket.java (cmd=43)

public class LanRoomPlayersRequestPacket extends Packet {
    public LanRoomPlayersRequestPacket(int ownerGuid) { super(ownerGuid); }
    @Override public byte getCommand() { return LanCommands.ROOM_PLAYERS_REQUEST; }
}

// æ–‡ä»¶: core/.../network/lan/packet/LanRoomPlayersResponsePacket.java (cmd=44)

public class LanRoomPlayersResponsePacket extends ResponsePacket {
    private List<LanPlayerStateSnapshot> players;

    public LanRoomPlayersResponsePacket(int ownerGuid, int repCode,
            List<LanPlayerStateSnapshot> players) {
        super(ownerGuid, repCode);
        this.players = players;
    }
    @Override public byte getCommand() { return LanCommands.ROOM_PLAYERS_RESPONSE; }
}
```

### 4.6 å¼€å§‹æ¸¸æˆä¿¡ä»¤

```java
// æ–‡ä»¶: core/.../network/lan/packet/LanGameStartRequestPacket.java (cmd=45)
// æˆ¿ä¸» â†’ æœåŠ¡å™¨

public class LanGameStartRequestPacket extends Packet {
    public LanGameStartRequestPacket(int ownerGuid) { super(ownerGuid); }
    @Override public byte getCommand() { return LanCommands.GAME_START_REQUEST; }
}

// æ–‡ä»¶: core/.../network/lan/packet/LanGameStartBroadcastPacket.java (cmd=46)
// æœåŠ¡å™¨ â†’ æ‰€æœ‰å®¢æˆ·ç«¯

public class LanGameStartBroadcastPacket extends ResponsePacket {
    public LanGameStartBroadcastPacket(int ownerGuid, int repCode) {
        super(ownerGuid, repCode);
    }
    @Override public byte getCommand() { return LanCommands.GAME_START_BROADCAST; }
}
```

### 4.7 æœ¬åœ°æ•°æ®æ¨¡å‹ â€” LanRoomPlayer

```java
// æ–‡ä»¶: core/.../network/lan/LanRoomPlayer.java
// ä¸å¯å˜å€¼å¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ä¸ªè¿œç¨‹ç©å®¶çš„å½“å‰çŠ¶æ€

public class LanRoomPlayer {
    private final int guid;
    private final String name;
    private final float x;         // é€»è¾‘åæ ‡
    private final float y;
    private final float vx;        // è§†è§‰åæ ‡
    private final float vy;
    private final String action;
    private final long timestamp;
}
```

### 4.8 ç½‘ç»œäº‹ä»¶ â€” LanNetworkEvent

```java
// æ–‡ä»¶: core/.../network/lan/LanNetworkEvent.java
// ç”¨äºä» Netty çº¿ç¨‹å®‰å…¨åœ°å‘æ¸¸æˆä¸»çº¿ç¨‹ä¼ é€’äº‹ä»¶

public class LanNetworkEvent {
    public enum Type {
        INFO,           // ç³»ç»Ÿä¿¡æ¯
        ERROR,          // é”™è¯¯
        CHAT,           // èŠå¤©
        LOGIN_SUCCESS,  // ç™»å½•æˆåŠŸ
        LOGIN_FAILED,   // ç™»å½•å¤±è´¥
        GAME_START      // å¼€å§‹æ¸¸æˆ
    }
    private final Type type;
    private final String message;
    private final long timestamp;

    // å·¥å‚æ–¹æ³•: info(), error(), chat(), loginSuccess(), loginFailed(), gameStart()
}
```

### 4.9 é¢„å¤‡æ’å€¼ç»„ä»¶ â€” NetworkTransformï¼ˆå·²ç¼–å†™ï¼Œå°šæœªå¯ç”¨ï¼‰

```java
// æ–‡ä»¶: core/.../network/lan/NetworkTransform.java
// åŸºäºå¿«ç…§çš„æ—¶é—´æ’å€¼å™¨ï¼Œè®¾è®¡ç”¨äºæ›¿ä»£ updateLan ä¸­çš„ç®€å• Lerp

public class NetworkTransform {
    private LanRoomPlayer previous;       // ä¸Šä¸€ä¸ªå¿«ç…§
    private LanRoomPlayer current;        // å½“å‰å¿«ç…§
    private boolean interpolationEnabled = true;
    private long interpolationDelayMs = 80L;  // æ¸²æŸ“å»¶è¿Ÿ 80ms

    public void pushSnapshot(LanRoomPlayer next) {
        // æŒ‰æ—¶é—´æˆ³æ’åºï¼Œä¿ç•™ previous + current ä¸¤ä¸ªå¿«ç…§
        if (this.current == null) {
            this.previous = next;
            this.current = next;
        } else if (next.getTimestamp() > this.current.getTimestamp()) {
            this.previous = this.current;
            this.current = next;
        }
    }

    /**
     * è·å–æ’å€¼åçš„ä½ç½®
     * å°†æ¸²æŸ“æ—¶é—´å€’é€€ interpolationDelayMsï¼Œåœ¨ previous å’Œ current ä¹‹é—´çº¿æ€§æ’å€¼
     */
    public float[] getInterpolatedPosition(long nowMs) {
        if (current == null) return new float[]{0f, 0f};
        if (!interpolationEnabled || previous == null)
            return new float[]{current.getX(), current.getY()};

        long renderTime = nowMs - interpolationDelayMs;
        long prevTime = previous.getTimestamp();
        long currTime = current.getTimestamp();
        if (currTime <= prevTime)
            return new float[]{current.getX(), current.getY()};

        float t = (renderTime - prevTime) / (float)(currTime - prevTime);
        t = Math.max(0f, Math.min(1f, t));

        float x = previous.getX() + (current.getX() - previous.getX()) * t;
        float y = previous.getY() + (current.getY() - previous.getY()) * t;
        return new float[]{x, y};
    }
}
```

---

## äº”ã€LanMultiplayerService â€” ç½‘ç»œæœåŠ¡æ ¸å¿ƒ

### 5.1 çŠ¶æ€ç®¡ç†

```java
// æ–‡ä»¶: core/.../network/lan/LanMultiplayerService.java

public class LanMultiplayerService {
    public enum Mode { NONE, HOST, CLIENT }

    private volatile Mode mode = Mode.NONE;
    private volatile String localName = "";
    private volatile int localGuid = -1;
    private volatile boolean connected = false;

    private volatile Server server;       // ä»… HOST æ¨¡å¼å¯åŠ¨
    private volatile Client client;       // æ‰€æœ‰æ¨¡å¼éƒ½å¯åŠ¨

    // çº¿ç¨‹å®‰å…¨å®¹å™¨
    private final ConcurrentLinkedQueue<LanNetworkEvent> eventQueue = new ConcurrentLinkedQueue<>();
    private final ConcurrentHashMap<Integer, LanRoomPlayer> players = new ConcurrentHashMap<>();
    private final ConcurrentHashMap<Integer, LanPlayerStateSnapshot> playerStates = new ConcurrentHashMap<>();

    // å‘é€é¢‘ç‡æ§åˆ¶
    private volatile long lastSyncMillis = 0L;
    private volatile long syncIntervalMs = 50L; // é»˜è®¤ 20Hz
```

### 5.2 æˆ¿ä¸»å¯åŠ¨æµç¨‹

```java
    public synchronized void startHost(String playerName, int serverPort) {
        stop();
        localName = playerName;
        ensureLanProtocolRegistered();

        String localIp = resolveLocalIp();

        // ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨ Serverï¼ˆçº¯ä¸­è½¬ï¼‰
        server = new Server();
        server.startAsync(new InetSocketAddress("0.0.0.0", serverPort),
                          new InetSocketAddress(localIp, serverPort), false);

        // ç¬¬äºŒæ­¥ï¼šæ³¨å†ŒæœåŠ¡å™¨è®¢é˜…ï¼ˆå¤„ç†åŒæ­¥/æˆ¿é—´/å¼€å§‹æ¸¸æˆè¯·æ±‚ï¼‰
        if (!registerServerSubscribers()) { stop(); return; }

        // ç¬¬ä¸‰æ­¥ï¼šä»¥ Client èº«ä»½è¿æ¥è‡ªå·±çš„ Server
        startClientInternal(playerName, localIp, serverPort);
        mode = Mode.HOST;
    }
```

### 5.3 æˆå‘˜åŠ å…¥æµç¨‹

```java
    public synchronized void join(String playerName, String hostIp, int hostPort) {
        stop();
        localName = playerName;
        ensureLanProtocolRegistered();
        startClientInternal(playerName, hostIp, hostPort);  // åªå¯åŠ¨ Client
        mode = Mode.CLIENT;
    }
```

### 5.4 å®¢æˆ·ç«¯å†…éƒ¨å¯åŠ¨ + ç™»å½•

```java
    private void startClientInternal(String playerName, String hostIp, int hostPort) {
        int localPort = randomUdpPort();
        client = new Client();
        client.start(new InetSocketAddress("0.0.0.0", localPort),
                     new InetSocketAddress(hostIp, hostPort), false);

        registerPacketSubscribers(client);  // æ³¨å†Œæ”¶åŒ…å›è°ƒ

        // å‘é€ç™»å½•è¯·æ±‚ï¼Œç­‰å¾…å“åº”
        LoginRequestPacket login = new LoginRequestPacket(-1, playerName, "lan");
        client.sendPacket(login, LoginResponsePacket.class, rep -> {
            if (IStatus.isSuccessStatus(rep)) {
                localGuid = rep.getOwnerGuid();
                client.setOwnerGuid(localGuid);
                connected = true;
                eventQueue.offer(LanNetworkEvent.loginSuccess("ç™»å½•æˆåŠŸ: guid=" + localGuid));
                requestRoomPlayers();  // ç™»å½•åç«‹å³æ‹‰å–æˆå‘˜åˆ—è¡¨
            } else {
                connected = false;
                eventQueue.offer(LanNetworkEvent.loginFailed("ç™»å½•å¤±è´¥"));
            }
        });
    }
```

### 5.5 å®¢æˆ·ç«¯æ”¶åŒ…è®¢é˜…

```java
    private void registerPacketSubscribers(Client c) {
        PacketsHandler handler = c.getPacketsHandler();
        if (handler == null) return;

        // â‘  ä½ç½®åŒæ­¥å¹¿æ’­ â†’ æ›´æ–° players Map
        handler.addSubscriber(LanPlayerSyncBroadcastPacket.class, packet -> {
            LanPlayerStateSnapshot state = packet.getState();
            if (state == null) return;
            if (state.getPlayerGuid() == localGuid) return;  // è¿‡æ»¤è‡ªå·±
            players.put(state.getPlayerGuid(), toLanRoomPlayer(state));
        });

        // â‘¡ æˆ¿é—´æˆå‘˜å“åº” â†’ æ‰¹é‡æ›´æ–° players Map
        handler.addSubscriber(LanRoomPlayersResponsePacket.class, packet -> {
            if (packet.getPlayers() == null) return;
            for (LanPlayerStateSnapshot state : packet.getPlayers()) {
                if (state == null || state.getPlayerGuid() == localGuid) continue;
                players.put(state.getPlayerGuid(), toLanRoomPlayer(state));
            }
            eventQueue.offer(LanNetworkEvent.info("æˆ¿é—´æˆå‘˜åˆ·æ–°: " + packet.getPlayers().size()));
        });

        // â‘¢ èŠå¤©å¹¿æ’­
        handler.addSubscriber(BroadcastResponsePacket.class, packet -> {
            eventQueue.offer(LanNetworkEvent.chat(packet.getMessage()));
        });

        // â‘£ å¼€å§‹æ¸¸æˆä¿¡å·
        handler.addSubscriber(LanGameStartBroadcastPacket.class, packet -> {
            eventQueue.offer(LanNetworkEvent.gameStart("æˆ¿ä¸»å·²å¼€å§‹æ¸¸æˆï¼"));
        });
    }
```

### 5.6 æœåŠ¡å™¨æ”¶åŒ…è®¢é˜…ï¼ˆçº¯ä¸­è½¬é€»è¾‘ï¼‰

```java
    private boolean registerServerSubscribers() {
        // ... ç­‰å¾… handler åˆå§‹åŒ–ï¼ˆæœ€å¤š 3 ç§’ï¼‰...
        handler.addSubscriber(LanPlayerSyncRequestPacket.class, this::onPlayerSyncRequest);
        handler.addSubscriber(LanRoomPlayersRequestPacket.class, this::onRoomPlayersRequest);
        handler.addSubscriber(LanGameStartRequestPacket.class, this::onGameStartRequest);
        return true;
    }

    /** æœåŠ¡å™¨æ”¶åˆ°ä½ç½®åŒæ­¥è¯·æ±‚ â†’ æ„å»ºå¿«ç…§ â†’ å¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯ */
    private void onPlayerSyncRequest(LanPlayerSyncRequestPacket packet) {
        if (server == null) return;
        int ownerGuid = packet.getOwnerGuid();
        ClientInfoStatus info = server.clients.get(ownerGuid);
        if (info == null) return;

        LanPlayerStateSnapshot state = new LanPlayerStateSnapshot(
            ownerGuid, info.name,
            packet.getX(), packet.getY(), packet.getVx(), packet.getVy(),
            packet.getAction(), packet.getTimestamp()
        );
        playerStates.put(ownerGuid, state);

        // å¹¿æ’­ç»™æ‰€æœ‰å·²ç™»å½•å®¢æˆ·ç«¯
        server.clients.forEach((targetGuid, ignored) -> {
            LanPlayerSyncBroadcastPacket rep = new LanPlayerSyncBroadcastPacket(
                targetGuid, IStatus.RETURN_SUCCESS, state);
            server.sendPacket(rep);
        });
    }

    /** æœåŠ¡å™¨æ”¶åˆ°æˆ¿é—´æŸ¥è¯¢è¯·æ±‚ â†’ æ±‡æ€»æ‰€æœ‰ç©å®¶çŠ¶æ€ â†’ å›å¤è¯·æ±‚è€… */
    private void onRoomPlayersRequest(LanRoomPlayersRequestPacket packet) {
        if (server == null) return;
        List<LanPlayerStateSnapshot> snapshots = new ArrayList<>();
        server.clients.forEach((guid, info) -> {
            LanPlayerStateSnapshot state = playerStates.get(guid);
            if (state == null) {
                state = new LanPlayerStateSnapshot(guid, info.name,
                    0f, 0f, 0f, 0f, "idle", System.currentTimeMillis());
                playerStates.put(guid, state);
            }
            state.setPlayerName(info.name);
            snapshots.add(state);
        });
        LanRoomPlayersResponsePacket rep = new LanRoomPlayersResponsePacket(
            packet.getOwnerGuid(), IStatus.RETURN_SUCCESS, snapshots);
        server.sendPacket(rep);
    }

    /** æœåŠ¡å™¨æ”¶åˆ°å¼€å§‹æ¸¸æˆè¯·æ±‚ â†’ å¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯ */
    private void onGameStartRequest(LanGameStartRequestPacket packet) {
        if (server == null) return;
        server.clients.forEach((targetGuid, ignored) -> {
            LanGameStartBroadcastPacket rep = new LanGameStartBroadcastPacket(
                targetGuid, IStatus.RETURN_SUCCESS);
            server.sendPacket(rep);
        });
    }
```

### 5.7 å‘é€æœ¬åœ°çŠ¶æ€ï¼ˆé¢‘ç‡æ§åˆ¶ï¼‰

```java
    public void sendLocalState(float x, float y, float vx, float vy, String action) {
        if (!connected || client == null || localGuid < 0) return;
        long now = System.currentTimeMillis();
        if (now - lastSyncMillis < syncIntervalMs) return;  // é¢‘ç‡é™åˆ¶
        lastSyncMillis = now;

        LanPlayerSyncRequestPacket packet = new LanPlayerSyncRequestPacket(
            localGuid, x, y, vx, vy, action, now);
        client.sendPacket(packet);
    }
```

### 5.8 åè®®æ³¨å†Œ

```java
    private static synchronized void ensureLanProtocolRegistered() {
        if (protocolRegistered) return;
        PacketCodeC.INSTANCE.registerPacketType(LanCommands.PLAYER_SYNC_REQUEST,   LanPlayerSyncRequestPacket.class);
        PacketCodeC.INSTANCE.registerPacketType(LanCommands.PLAYER_SYNC_BROADCAST, LanPlayerSyncBroadcastPacket.class);
        PacketCodeC.INSTANCE.registerPacketType(LanCommands.ROOM_PLAYERS_REQUEST,  LanRoomPlayersRequestPacket.class);
        PacketCodeC.INSTANCE.registerPacketType(LanCommands.ROOM_PLAYERS_RESPONSE, LanRoomPlayersResponsePacket.class);
        PacketCodeC.INSTANCE.registerPacketType(LanCommands.GAME_START_REQUEST,    LanGameStartRequestPacket.class);
        PacketCodeC.INSTANCE.registerPacketType(LanCommands.GAME_START_BROADCAST,  LanGameStartBroadcastPacket.class);
        protocolRegistered = true;
    }
```

---

## å…­ã€æ¸²æŸ“å±‚ â€” è¿œç¨‹ç©å®¶å¦‚ä½•æ˜¾ç¤º

```java
// æ–‡ä»¶: examples/.../screens/main/GameRenderer.java

/** ç»˜åˆ¶æ‰€æœ‰å®ä½“ï¼ˆæ•Œäºº+ç©å®¶+è¿œç¨‹ç©å®¶ï¼‰ */
private void drawEntities() {
    Array<GameEntity> enemies = state.getEnemies();
    GameEntity player = state.getPlayer();
    Array<GameEntity> remotePlayers = state.getRemotePlayers();

    // å…ˆç”»æ•Œäºº
    for (int i = 0; i < enemies.size; i++) {
        GameEntity e = enemies.get(i);
        if (!e.alive) continue;
        drawEntity(e, player, false);
    }

    // å†ç”»è¿œç¨‹ç©å®¶ï¼ˆè”æœºæ¨¡å¼æ—¶ remotePlayers æœ‰å†…å®¹ï¼Œå•æœºä¸ºç©ºæ•°ç»„ï¼‰
    if (remotePlayers != null) {
        for (int i = 0; i < remotePlayers.size; i++) {
            GameEntity e = remotePlayers.get(i);
            if (!e.alive) continue;
            drawEntity(e, player, true);  // isRemotePlayer = true
        }
    }

    // æœ€åç”»æœ¬åœ°ç©å®¶ï¼ˆä¿è¯åœ¨æœ€ä¸Šå±‚ï¼‰
    if (player.alive) drawEntity(player, player, false);
}

/** ç»˜åˆ¶å•ä¸ªå®ä½“ */
private void drawEntity(GameEntity e, GameEntity player, boolean isRemotePlayer) {
    float drawX = e.visualX + e.bumpX;
    float drawY = e.visualY + e.bumpY;

    TextureRegion tex = TextureManager.get(e.texName);
    if (tex != null) {
        batch.draw(tex, drawX, drawY, TILE, TILE);
    } else {
        // æ— è´´å›¾æ—¶çš„é¢œè‰²åŒºåˆ†ï¼š
        Color c = isRemotePlayer ? Color.ORANGE : Color.CYAN;
        //                         ^^^^^^^^       ^^^^^^^^
        //                         è¿œç¨‹=æ©™è‰²     æœ¬åœ°/æ•Œäºº=é’è‰²
        batch.drawRect(drawX + 2, drawY + 2, TILE - 4, TILE - 4, 0, 0, c, true);
    }

    // è¡€æ¡é¢œè‰²åŒºåˆ†
    batch.drawRect(barX, barY, barW * (e.hp / e.getMaxHp()), barH, 0, 0,
        e == player ? Color.GREEN : (isRemotePlayer ? Color.YELLOW : Color.RED), true);
    //                                                ^^^^^^^^
    //                                          è¿œç¨‹ç©å®¶è¡€æ¡=é»„è‰²
}
```

---

## ä¸ƒã€åŒæ­¥è´¨é‡è¯„ä¼°

### 7.1 å·²å…·å¤‡çš„èƒ½åŠ›

| ç»´åº¦ | å®ç° | è¯„ä»· |
|---|---|---|
| ä¼ è¾“åè®® | UDP (Netty) | âœ… é€‚åˆå®æ—¶åŒæ­¥ |
| åºåˆ—åŒ– | Gson JSON | âœ… å¯è¯»æ€§å¥½ï¼Œæ€§èƒ½å¯æ¥å— |
| åŒæ­¥é¢‘ç‡ | 50ms / 20Hzï¼ˆå¯é…ç½®ï¼‰ | âœ… åˆç† |
| çº¿ç¨‹å®‰å…¨ | `ConcurrentHashMap` + `ConcurrentLinkedQueue` | âœ… Nettyçº¿ç¨‹ â†’ ä¸»çº¿ç¨‹å®‰å…¨ |
| æ”¶åŒ…è¿‡æ»¤ | è·³è¿‡ `localGuid == è‡ªå·±` | âœ… é¿å…è‡ªå›ç¯ |
| å®¢æˆ·ç«¯æ’å€¼ | `re.visualX += (target - current) * 10f * delta` | âœ… åŸºæœ¬å¯ç”¨ |
| åè®®ç±»å‹ | 6ä¸ªè‡ªå®šä¹‰åŒ… + æ¡†æ¶å†…ç½®ç™»å½•/å¹¿æ’­ | âœ… å®Œæ•´ |
| æ–­çº¿æ£€æµ‹ | `volatile connected` æ ‡å¿— | âš ï¸ ä»…åœ¨ç™»å½•æ—¶è®¾ç½®ï¼Œæ— å¿ƒè·³æœºåˆ¶ |

### 7.2 å·²ç¼–å†™ä½†æœªå¯ç”¨çš„èƒ½åŠ›

| ç»„ä»¶ | è¯´æ˜ |
|---|---|
| `NetworkTransform` | åŸºäºåŒå¿«ç…§çš„æ—¶é—´å»¶è¿Ÿæ’å€¼ï¼ˆ80ms delayï¼‰ï¼Œæ¯”å½“å‰çš„ç®€å• Lerp æ›´å¹³æ»‘ã€‚å·²ç¼–å†™å®Œæ•´ï¼Œä½† `SimpleGameScreen.updateLan()` ä¸­æœªä½¿ç”¨ã€‚ |
| `LanPlayerStateSnapshot.action` | å­—æ®µå·²å®šä¹‰ï¼Œä½† `sendLocalState` å›ºå®šä¼  `"idle"`ï¼Œæœªæ¥å…¥åŠ¨ç”»çŠ¶æ€æœºã€‚ |

### 7.3 å·²åŒæ­¥ vs æœªåŒæ­¥å†…å®¹æ€»è¡¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å·²åŒæ­¥ âœ…                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ é€»è¾‘åæ ‡ (x, y)           â€” æ ¼å­ä½ç½®                      â”‚
â”‚ â€¢ è§†è§‰åæ ‡ (vx, vy)         â€” åƒç´ ä½ç½®ï¼ˆç”¨äºæ’å€¼æ¸²æŸ“ï¼‰        â”‚
â”‚ â€¢ åŠ¨ä½œæ ‡è¯† (action)          â€” é¢„ç•™å­—æ®µï¼Œå½“å‰å›ºå®š "idle"      â”‚
â”‚ â€¢ æ—¶é—´æˆ³ (timestamp)         â€” ç”¨äºå¿«ç…§æ’åº/æ’å€¼              â”‚
â”‚ â€¢ ç©å®¶æ ‡è¯† (guid, name)      â€” èº«ä»½è¯†åˆ«                      â”‚
â”‚ â€¢ æˆ¿é—´æˆå‘˜åˆ—è¡¨                â€” ç™»å½•æ—¶æ‹‰å–                    â”‚
â”‚ â€¢ å¼€å§‹æ¸¸æˆä¿¡å·                â€” æˆ¿ä¸» â†’ å…¨ä½“å¹¿æ’­               â”‚
â”‚ â€¢ èŠå¤©æ¶ˆæ¯                   â€” æ–‡æœ¬å¹¿æ’­                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      æœªåŒæ­¥ âŒ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ åœ°å›¾ (int[][] map)         â€” å„ç«¯ç‹¬ç«‹ç”Ÿæˆï¼Œæ— å…±äº«ç§å­       â”‚
â”‚ â€¢ æ•Œäºº (enemies)             â€” å„ç«¯ç‹¬ç«‹ç”Ÿæˆ + ç‹¬ç«‹AI          â”‚
â”‚ â€¢ æˆ˜æ–—åˆ¤å®š                    â€” æ”»å‡»/ä¼¤å®³/å‡»æ€çº¯æœ¬åœ°è®¡ç®—       â”‚
â”‚ â€¢ HP / MP / å±æ€§             â€” ä¸ä¼ è¾“                        â”‚
â”‚ â€¢ æˆé•¿/ç»éªŒ/ç­‰çº§              â€” å„ç«¯ç‹¬ç«‹è®¡ç®—                  â”‚
â”‚ â€¢ æ¥¼æ¢¯/æ¢å±‚                  â€” å„ç«¯ç‹¬ç«‹è§¦å‘                   â”‚
â”‚ â€¢ æ­»äº¡/é‡ç”Ÿ                  â€” æœ¬åœ°å¤„ç†                      â”‚
â”‚ â€¢ åŠ¨ç”»çŠ¶æ€ï¼ˆæ”»å‡»/å—ä¼¤ï¼‰       â€” action å­—æ®µæœªæ¥å…¥              â”‚
â”‚ â€¢ è£…å¤‡/é“å…·                  â€” ä¸å­˜åœ¨è”æœºåŒæ­¥                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.4 å½“å‰æ¨¡å‹å®šæ€§

**"ä½ç½®å¯è§"åŒæ­¥æ¨¡å‹** â€” å¤šäººèƒ½çœ‹åˆ°å½¼æ­¤åœ¨å„è‡ªåœ°å›¾ä¸Šèµ°åŠ¨ï¼Œä½†ç”±äºåœ°å›¾/æ•Œäºº/æˆ˜æ–—ç‹¬ç«‹è¿è¡Œï¼Œ  
å®é™…æ•ˆæœæ˜¯ **"å„ç©å„çš„ + èƒ½çœ‹åˆ°å¯¹æ–¹çš„å½±å­"**ã€‚

```
â”Œâ”€â”€â”€â”€ ç©å®¶A çš„å±å¹• â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€ ç©å®¶B çš„å±å¹• â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€å¢™â”€å¢™â”€å¢™â”€å¢™â”€å¢™â”€â”   â”‚   â”‚ â”Œâ”€å¢™â”€å¢™â”€å¢™â”€å¢™â”€å¢™â”€â”   â”‚
â”‚ â”‚  .  .  ğŸŸ   .  . â”‚   â”‚   â”‚ â”‚  .  .  .  .  . â”‚   â”‚
â”‚ â”‚  .  A  .  å¢™  . â”‚   â”‚   â”‚ â”‚  .  ğŸŸ   .  å¢™  . â”‚   â”‚
â”‚ â”‚  .  .  ğŸ‘¹  .  . â”‚   â”‚   â”‚ â”‚  .  .  .  ğŸ‘¹  B â”‚   â”‚
â”‚ â”‚  .  å¢™  .  .  . â”‚   â”‚   â”‚ â”‚  .  å¢™  .  .  . â”‚   â”‚
â”‚ â”‚  .  .  .  .  ğŸ”½ â”‚   â”‚   â”‚ â”‚  .  .  .  .  ğŸ”½ â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ A=è‡ªå·±(é’) ğŸŸ =B(æ©™)   â”‚   â”‚ B=è‡ªå·±(é’) ğŸŸ =A(æ©™)   â”‚
â”‚ ğŸ‘¹=è‡ªå·±çš„æ•Œäºº(å„ä¸åŒ)  â”‚   â”‚ ğŸ‘¹=è‡ªå·±çš„æ•Œäºº(å„ä¸åŒ)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…«ã€æ¶‰åŠæ–‡ä»¶æ¸…å•

| æ–‡ä»¶è·¯å¾„ | èŒè´£ |
|---|---|
| `core/.../network/lan/LanMultiplayerService.java` | è”æœºæœåŠ¡æ ¸å¿ƒï¼šServer/Client ç®¡ç†ã€æ”¶å‘åŒ…ã€äº‹ä»¶é˜Ÿåˆ— |
| `core/.../network/lan/LanRoomPlayer.java` | è¿œç¨‹ç©å®¶ä¸å¯å˜å€¼å¯¹è±¡ |
| `core/.../network/lan/LanNetworkEvent.java` | Nettyçº¿ç¨‹â†’ä¸»çº¿ç¨‹çš„äº‹ä»¶ä¼ é€’ |
| `core/.../network/lan/NetworkTransform.java` | å¿«ç…§æ’å€¼ç»„ä»¶ï¼ˆé¢„å¤‡ï¼Œæœªå¯ç”¨ï¼‰ |
| `core/.../network/lan/packet/LanCommands.java` | åè®®å‘½ä»¤å­—èŠ‚å®šä¹‰ |
| `core/.../network/lan/packet/LanPlayerStateSnapshot.java` | çŠ¶æ€å¿«ç…§ï¼ˆåŒæ­¥è½½è·ï¼‰ |
| `core/.../network/lan/packet/LanPlayerSyncRequestPacket.java` | ä¸Šè¡Œï¼šå®¢æˆ·ç«¯â†’æœåŠ¡å™¨ ä½ç½®åŒæ­¥ |
| `core/.../network/lan/packet/LanPlayerSyncBroadcastPacket.java` | ä¸‹è¡Œï¼šæœåŠ¡å™¨â†’å…¨ä½“ ä½ç½®å¹¿æ’­ |
| `core/.../network/lan/packet/LanRoomPlayersRequestPacket.java` | ä¸Šè¡Œï¼šè¯·æ±‚æˆå‘˜åˆ—è¡¨ |
| `core/.../network/lan/packet/LanRoomPlayersResponsePacket.java` | ä¸‹è¡Œï¼šè¿”å›æˆå‘˜åˆ—è¡¨ |
| `core/.../network/lan/packet/LanGameStartRequestPacket.java` | ä¸Šè¡Œï¼šæˆ¿ä¸»è¯·æ±‚å¼€å§‹æ¸¸æˆ |
| `core/.../network/lan/packet/LanGameStartBroadcastPacket.java` | ä¸‹è¡Œï¼šå¹¿æ’­å¼€å§‹æ¸¸æˆä¿¡å· |
| `examples/.../screens/main/SimpleGameScreen.java` | æ¸¸æˆåœºæ™¯ï¼ˆå•æœº+è”æœºä¸€ä½“ï¼‰ |
| `examples/.../screens/main/GameRenderer.java` | æ¸²æŸ“å±‚ï¼ˆå«è¿œç¨‹ç©å®¶ç»˜åˆ¶é€»è¾‘ï¼‰ |
