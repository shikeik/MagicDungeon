# UI 与视口架构优化方案

## 1. 目标
- **统一 UI 风格**: 将临时的 `GameHUD` 替换为基于 `VisUI` 的现代化界面，保持与引擎其他部分一致的视觉体验。
- **规范视口管理**: 移除手动管理的 `FitViewport`，采用 `GScreen` 架构提供的双相机/双视口机制（World Camera + UI Viewport），确保在不同分辨率下的正确适配与缩放。

## 2. 现状分析
- **当前视口**: `GameScreen` 内部手动创建了 `FitViewport` 和 `OrthographicCamera`，未利用 `GScreen` 父类提供的 `worldCamera` 和 `uiViewport` 机制。这导致缩放逻辑可能与引擎标准不一致，且代码冗余。
- **当前 UI**: `GameHUD` 使用原生 `Scene2D` 组件，样式简单，缺乏统一的主题管理 (`VisUI` Skin)。

## 3. 实施步骤

### 阶段一：视口架构重构 (Viewport Refactor)
1.  **继承调整**: 确保 `GameScreen` 正确利用 `GScreen` 的生命周期。
2.  **移除冗余**: 删除 `GameScreen` 中私有的 `camera` 和 `viewport` 成员。
3.  **启用 GScreen 机制**:
    - 重写 `initViewport()`: 设置 `worldScale` 和基础分辨率。
    - 使用 `worldCamera` 进行游戏场景渲染。
    - 使用 `getUIViewport()` 进行 HUD 渲染。
4.  **坐标转换**: 确保输入处理（如点击移动）正确使用 `unproject` 转换屏幕坐标到世界坐标。

### 阶段二：UI 升级 (VisUI Integration)
1.  **重构 GameHUD**:
    - 将 `GameHUD` 改为继承 `VisTable` 或管理一个 `VisTable`。
    - 使用 `VisLabel`, `VisTextButton`, `VisProgressBar` 等组件替换原生组件。
    - 引入 `VisUIHelper` 或现有 Skin 资源。
2.  **布局优化**:
    - 顶部: 状态栏 (HP, Mana, Level, Floor)。
    - 底部: 消息日志 (Message Log) 和 操作栏。
    - 弹窗: 替换原生 `Dialog` 为 `VisWindow` 实现背包和菜单。

### 阶段三：交互优化
1.  **输入处理器**: 使用 `GScreen` 的 `getImp()` (InputMultiplexer) 统一管理 UI 和 游戏世界的输入，防止穿透。

## 4. 预期结果
- 游戏画面在任意窗口大小下均能正确保持纵横比并自适应缩放。
- UI 界面清晰、美观，具有统一的风格。
- 代码更加简洁，符合 `gdengine` 架构规范。
